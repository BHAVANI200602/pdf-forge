<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Forge - Convert Images to PDF</title>
    <meta name="description" content="Effortlessly convert images to PDF with PDF Forge. Merge, compress, split, edit PDFs (annotate, extract, JPG) for free, client-side.">
    <meta name="keywords" content="PDF converter, images to PDF, merge PDF, compress PDF, split PDF, annotate PDF, extract PDF, PDF to JPG, reorder PDF pages, PDF page reorder, rearrange PDF pages, PDF tools, free PDF editor">
    <meta name="robots" content="index, follow">
    <meta name="author" content="PDF Forge">
    <!-- Open Graph Tags -->
    <meta property="og:title" content="PDF Forge - Convert Images to PDF">
    <meta property="og:description" content="Effortlessly convert images to PDF with PDF Forge. Merge, compress, split, edit PDFs (annotate, extract, JPG) for free, client-side.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pdf-forge-lemon.vercel.app">
    <meta property="og:image" content="https://pdf-forge-lemon.vercel.app/public/og-image.jpg">
    <meta property="og:site_name" content="PDF Forge">
    <meta property="og:locale" content="en_US">
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PDF Forge - Convert Images to PDF">
    <meta name="twitter:description" content="Effortlessly convert images to PDF with PDF Forge. Merge, compress, split, edit PDFs (annotate, extract, JPG) for free, client-side.">
    <meta name="twitter:image" content="https://pdf-forge-lemon.vercel.app/public/og-image.jpg">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://pdf-forge-lemon.vercel.app/">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="icon" href="../public/favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #000;
            color: #fff;
        }
        header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(90deg, #000, #111);
            border-bottom: 2px solid #fff;
        }
        .logo, .tagline {
            transition: text-shadow 0.3s ease-in-out;
        }
        .logo {
            font-size: 2.5rem;
            color: #fff;
        }
        .tagline {
            font-size: 1.2rem;
            color: #ccc;
        }
        .logo:hover, .tagline:hover {
            text-shadow: 0 0 10px #fff, 0 0 20px #fff;
        }
        .card {
            margin: 20px auto;
            padding: 20px;
            max-width: 800px;
            background-color: #111;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        #drag-drop-area {
            border: 2px dashed #fff;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
        }
        #drag-drop-area p {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        #drag-drop-area.drag-over {
            border-color: #fff;
            background-color: rgba(255, 255, 255, 0.1);
        }
        #file-upload {
            margin-top: 10px;
        }
        .convert-btn, .reset-btn, .tools-btn {
            background-color: #fff;
            color: #000;
            border: none;
            margin: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
        }
        .convert-btn, .reset-btn {
            padding: 10px 20px;
            font-size: 1rem;
        }
        .tools-btn {
            padding: 14px 20px;
            font-size: 1.2rem;
            font-weight: bold;
            display: block;
            width: calc(100% - 40px);
            max-width: 760px;
            margin: 0 auto;
        }
        .convert-btn:hover, .reset-btn:hover, .tools-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px #fff;
            background-color: #f0f0f0;
        }
        .tools-btn-container {
            text-align: center;
            margin-top: 15px;
        }
        .progress-message {
            color: #ccc;
            margin: 10px auto;
            font-size: 1rem;
            text-align: center;
            max-width: 800px;
        }
        footer {
            text-align: center;
            padding: 20px;
            background: #111;
            border-top: 2px solid #fff;
            color: #ccc;
        }
        footer ul {
            text-align: left;
            max-width: 800px;
            margin: 20px auto;
            padding-left: 20px;
        }
        #file-list {
            margin-top: 10px;
            color: #ccc;
            font-size: 1rem;
        }
        #tools-button, #info-button {
            position: fixed;
            background-color: transparent;
            border: none;
            cursor: pointer;
            width: 24px;
            height: 24px;
            z-index: 1000;
            transition: transform 0.2s, filter 0.2s;
        }
        #tools-button {
            top: 20px;
            left: 20px;
        }
        #info-button {
            top: 20px;
            right: 20px;
        }
        #tools-button:hover, #info-button:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px #fff);
        }
        #tools-button:hover svg, #info-button:hover svg {
            fill: #ccc;
            stroke: #ccc;
        }
        #tools-popup, #info-popup {
            position: fixed;
            top: 0;
            right: -290px;
            width: 250px;
            height: 100%;
            background-color: #111;
            color: #fff;
            box-shadow: -2px 0 10px rgba(255, 255, 255, 0.5);
            transition: right 0.3s ease-in-out;
            padding: 20px;
            padding-bottom: 40px;
            overflow-y: auto;
            scrollbar-width: auto;
            scrollbar-color: #ccc #222;
            z-index: 999;
        }
        #tools-popup::-webkit-scrollbar, #info-popup::-webkit-scrollbar {
            width: 8px;
        }
        #tools-popup::-webkit-scrollbar-thumb, #info-popup::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }
        #tools-popup::-webkit-scrollbar-track, #info-popup::-webkit-scrollbar-track {
            background: #222;
        }
        #tools-popup.open, #info-popup.open {
            right: 0;
        }
        #tools-popup h2, #info-popup h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: none;
        }
        #info-nav {
            margin-bottom: 30px;
        }
        #tools-popup a, #info-nav a {
            display: block;
            color: #fff;
            text-decoration: none;
            margin: 8px 0;
            padding: 8px;
            background-color: #222;
            border-radius: 5px;
            text-align: center;
            transition: background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 0 3px rgba(255, 255, 255, 0.2);
        }
        #tools-popup a:hover, #info-nav a:hover {
            background-color: #333;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
        }
        #info-content {
            margin-top: 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        #info-content h3 {
            margin: 15px 0 10px;
            color: #fff;
        }
        #info-content p {
            margin: 5px 0;
            color: #ccc;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
        .tooltip {
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #555;
            font-size: 0.9rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            z-index: 1002;
        }
        #tools-button .tooltip {
            top: 50%;
            left: 40px;
            transform: translateY(-50%);
        }
        #info-button .tooltip {
            top: 50%;
            right: 40px;
            transform: translateY(-50%);
        }
        #tools-button:hover .tooltip,
        #tools-button:focus .tooltip,
        #info-button:hover .tooltip,
        #info-button:focus .tooltip {
            opacity: 1;
            transition-delay: 0.1s;
        }
        @media (max-width: 800px) {
            .card {
                max-width: 90vw;
                margin: 15px auto;
                padding: 15px;
            }
            .tools-btn {
                width: calc(100% - 30px);
                max-width: none;
                padding: 12px 18px;
                font-size: 1.1rem;
            }
            #drag-drop-area {
                height: 180px;
            }
            #drag-drop-area p {
                font-size: 1.1rem;
            }
        }
        @media (max-width: 600px) {
            .card {
                margin: 10px;
                padding: 15px;
            }
            .tools-btn {
                width: calc(100% - 30px);
                padding: 10px 15px;
                font-size: 1rem;
            }
            #drag-drop-area {
                height: 150px;
            }
            #drag-drop-area p {
                font-size: 1rem;
            }
            .convert-btn, .reset-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            #file-list p {
                font-size: 0.9rem;
            }
            #tools-popup, #info-popup {
                width: 220px;
                right: -260px;
            }
            #tools-popup.open, #info-popup.open {
                right: 0;
            }
            #tools-button, #info-button {
                width: 20px;
                height: 20px;
            }
            #info-nav {
                margin-bottom: 20px;
            }
            #tools-popup a, #info-nav a {
                margin: 6px 0;
                padding: 6px;
                font-size: 0.9rem;
            }
            .tooltip {
                font-size: 0.8rem;
                padding: 5px 8px;
            }
            #tools-button .tooltip {
                left: 32px;
            }
            #info-button .tooltip {
                right: 32px;
            }
        }
        @media (max-width: 400px) {
            .card {
                margin: 5px;
                padding: 10px;
            }
            .tools-btn {
                width: calc(100% - 20px);
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            #drag-drop-area {
                height: 120px;
                padding: 15px;
            }
            #drag-drop-area p {
                font-size: 0.9rem;
            }
            .convert-btn, .reset-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <h1 class="logo">PDF Forge</h1>
            <p class="tagline">Convert, edit, and manage your PDFs effortlessly!</p>
        </div>
    </header>
    <main>
        <button id="tools-button" aria-label="Open tools menu">
            <span class="sr-only">Open tools menu</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="#fff" aria-hidden="true">
                <circle cx="4" cy="4" r="2"/>
                <circle cx="12" cy="4" r="2"/>
                <circle cx="20" cy="4" r="2"/>
                <circle cx="4" cy="12" r="2"/>
                <circle cx="12" cy="12" r="2"/>
                <circle cx="20" cy="12" r="2"/>
                <circle cx="4" cy="20" r="2"/>
                <circle cx="12" cy="20" r="2"/>
                <circle cx="20" cy="20" r="2"/>
            </svg>
            <span class="tooltip">Other Tools</span>
        </button>
        <button id="info-button" aria-label="Open information menu">
            <span class="sr-only">Open information menu</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 8v8"/>
                <circle cx="12" cy="6" r="1"/>
            </svg>
            <span class="tooltip">More Info</span>
        </button>
        <p class="progress-message" id="progress-message"></p>
        <section id="upload-section" class="card">
            <h2>Upload Images</h2>
            <div id="drag-drop-area">
                <p>Drag & Drop your images here (or tap to select)</p>
                <input type="file" id="file-upload" accept="image/jpeg,image/png,image/gif,image/bmp,image/tiff,image/heic,image/heif" multiple aria-label="Upload images">
            </div>
            <div id="file-list"></div>
            <button class="convert-btn" id="convert-images-btn" aria-label="Convert uploaded images to PDF">Convert Images to PDF</button>
            <button class="reset-btn" id="reset-files-btn" aria-label="Reset uploaded images">Reset Files</button>
        </section>
        <section id="tools-section" class="card">
            <h2>Looking for other tools?</h2>
            <p>Explore more PDF tools like merging, splitting, or annotating!</p>
            <div class="tools-btn-container">
                <button class="tools-btn" id="explore-tools-btn" aria-label="Explore other PDF tools">Explore Tools</button>
            </div>
        </section>
    </main>
    <footer>
        <h2>ðŸ“– How to Use</h2>
        <ul>
            <li><strong>Convert Images to PDF:</strong> You already know how to use this! ðŸ˜Ž Drag and drop images or click to upload, then hit "Convert Images to PDF" for a shiny new PDF.</li>
            <li>Use the "Reset Files" button to clear images and start fresh.</li>
            <li>Click the grid menu or "Explore Tools" button to check out other PDF tools like merging, splitting, or annotating.</li>
            <li>Click the information icon for Privacy Policy, Terms of Use, and more.</li>
        </ul>
        <p>Â© 2025 PDF Forge. All rights reserved.</p>
    </footer>
    <div id="tools-popup" role="dialog" aria-modal="true" aria-labelledby="tools-popup-title">
        <h2 id="tools-popup-title">Available Tools</h2>
        <a href="merge.html" title="Combine multiple PDFs into one" aria-describedby="merge-desc">Merge PDFs</a>
        <span id="merge-desc" class="sr-only">Combine multiple PDFs into one</span>
        <a href="compress.html" title="Reduce PDF file size" aria-describedby="compress-desc">Compress PDFs</a>
        <span id="compress-desc" class="sr-only">Reduce PDF file size</span>
        <a href="to-jpg.html" title="Convert PDFs to JPG images" aria-describedby="to-jpg-desc">Convert to JPG</a>
        <span id="to-jpg-desc" class="sr-only">Convert PDFs to JPG images</span>
        <a href="split.html" title="Split a PDF into multiple files" aria-describedby="split-desc">Split PDF</a>
        <span id="split-desc" class="sr-only">Split a PDF into multiple files</span>
        <a href="reorder.html" title="Rearrange PDF pages" aria-describedby="reorder-desc">Reorder Pages</a>
        <span id="reorder-desc" class="sr-only">Rearrange PDF pages</span>
        <a href="extract.html" title="Extract text or images from PDFs" aria-describedby="extract-desc">Extract Text/Images</a>
        <span id="extract-desc" class="sr-only">Extract text or images from PDFs</span>
        <a href="annotate.html" title="Add notes or highlights to PDFs" aria-describedby="annotate-desc">Add Annotations</a>
        <span id="annotate-desc" class="sr-only">Add notes or highlights to PDFs</span>
    </div>
    <div id="info-popup" role="dialog" aria-modal="true" aria-labelledby="info-popup-title">
        <h2 id="info-popup-title">Information</h2>
        <nav id="info-nav">
            <a href="#privacy" class="info-link">Privacy Policy</a>
            <a href="#terms" class="info-link">Terms of Use</a>
            <a href="#acknowledgements" class="info-link">Acknowledgements</a>
            <a href="#contact" class="info-link">Contact</a>
        </nav>
        <div id="info-content">
            <div id="privacy">
                <h3>Privacy Policy</h3>
                <p>At PDF Forge, your privacy is our top priority. All our tools run client-side in your browser, so no data, files, or personal info ever touches our servers. Your uploaded files (images, PDFs) stay on your device. We use analytics to understand how users interact with our site (e.g., tracking clicks and visits) in an anonymized manner, which may involve cookies. For AdSense ads, Google may collect anonymized data per their <a href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a>. Last updated: May 12, 2025.</p>
            </div>
            <div id="terms">
                <h3>Terms of Use</h3>
                <p>By using PDF Forge, you agree to these terms. Our tools (e.g., image-to-PDF) are for personal, non-commercial use and run client-side. Weâ€™re not responsible for the content of your files or PDFs. Donâ€™t use our tools for illegal stuff or copyrighted material without permission. Tools are provided "as is" with no warranties. Last updated: May 12, 2025.</p>
            </div>
            <div id="acknowledgements">
                <h3>Open Source Acknowledgements</h3>
                <p>This website uses open-source software libraries, licensed under the MIT License. Copyrights and licenses are retained as required.</p>
            </div>
            <div id="contact">
                <h3>Contact</h3>
                <p>Got questions? Want to share feedback? Reach out via our contact form or email (details coming soon). Weâ€™ll get back to you faster than you can say "PDF"! ðŸ˜„</p>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script>
        const fileInput = document.getElementById('file-upload');
        const fileList = document.getElementById('file-list');
        const convertImagesBtn = document.getElementById('convert-images-btn');
        const resetFilesBtn = document.getElementById('reset-files-btn');
        const dragDropArea = document.getElementById('drag-drop-area');
        const progressMessage = document.getElementById('progress-message');
        const exploreToolsBtn = document.getElementById('explore-tools-btn');
        let selectedFiles = [];

        // Define supported image formats (MIME types and extensions)
        const supportedImageTypes = [
            'image/jpeg', 'image/png', 'image/gif', 'image/bmp', 'image/tiff',
            'image/heic', 'image/heif'
        ];
        const supportedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'tiff', 'heic', 'heif'];

        // Validate file type
        function isSupportedImage(file) {
            const extension = file.name.split('.').pop().toLowerCase();
            return supportedImageTypes.includes(file.type) || supportedExtensions.includes(extension);
        }

        // Handle file input change
        fileInput.addEventListener('change', () => {
            const newFiles = Array.from(fileInput.files).filter(file => {
                if (isSupportedImage(file)) {
                    return true;
                } else {
                    progressMessage.textContent = `Unsupported file format: ${file.name}. Please upload JPEG, PNG, GIF, BMP, TIFF, or HEIC images.`;
                    return false;
                }
            });

            if (newFiles.length === 0 && fileInput.files.length > 0) {
                progressMessage.textContent = 'No supported image files were selected. Supported formats: JPEG, PNG, GIF, BMP, TIFF, HEIC.';
            }

            selectedFiles = [...selectedFiles, ...newFiles];
            fileInput.value = '';
            updateFileList();
        });

        // Drag-and-drop functionality
        dragDropArea.addEventListener('dragover', (event) => {
            event.preventDefault();
            dragDropArea.classList.add('drag-over');
        });

        dragDropArea.addEventListener('dragleave', () => {
            dragDropArea.classList.remove('drag-over');
        });

        dragDropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dragDropArea.classList.remove('drag-over');
            const droppedFiles = Array.from(event.dataTransfer.files).filter(file => {
                if (isSupportedImage(file)) {
                    return true;
                } else {
                    progressMessage.textContent = `Unsupported file format: ${file.name}. Please upload JPEG, PNG, GIF, BMP, TIFF, or HEIC images.`;
                    return false;
                }
            });

            if (droppedFiles.length === 0 && event.dataTransfer.files.length > 0) {
                progressMessage.textContent = 'No supported image files were dropped. Supported formats: JPEG, PNG, GIF, BMP, TIFF, HEIC.';
            }

            selectedFiles = [...selectedFiles, ...droppedFiles];
            updateFileList();
        });

        // Update file list display
        function updateFileList() {
            fileList.innerHTML = '';
            if (selectedFiles.length > 0) {
                dragDropArea.querySelector('p').textContent = 'Add more images here (or tap to select)';
                selectedFiles.forEach((file, index) => {
                    const listItem = document.createElement('p');
                    listItem.textContent = `${index + 1}. ${file.name}`;
                    fileList.appendChild(listItem);
                });
            } else {
                dragDropArea.querySelector('p').textContent = 'Drag & Drop your images here (or tap to select)';
            }
        }

        // Convert file to base64
        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = () => reject(new Error(`Failed to read file: ${file.name}`));
                reader.readAsDataURL(file);
            });
        }

        // Load and normalize image to JPEG
        async function loadAndNormalizeImage(file) {
            try {
                // Convert file to base64
                const base64Data = await fileToBase64(file);
                
                // Create an image element to load the base64 data
                const img = new Image();
                img.src = base64Data;
                
                await new Promise((resolve, reject) => {
                    img.onload = () => resolve();
                    img.onerror = () => reject(new Error(`Failed to load image: ${file.name}`));
                });

                // Create a canvas to normalize the image to JPEG
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                // Resize image to a maximum dimension of 1000px to prevent memory issues
                let { width, height } = img;
                const maxDimension = 1000;
                if (width > height) {
                    if (width > maxDimension) {
                        height = Math.round((height * maxDimension) / width);
                        width = maxDimension;
                    }
                } else {
                    if (height > maxDimension) {
                        width = Math.round((width * maxDimension) / height);
                        height = maxDimension;
                    }
                }

                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);

                // Convert to JPEG base64
                const jpegDataUrl = canvas.toDataURL('image/jpeg', 0.9);
                const base64String = jpegDataUrl.split(',')[1]; // Remove the data:image/jpeg;base64, prefix

                return { base64: base64String, width, height };
            } catch (error) {
                throw new Error(`Image processing failed for ${file.name}: ${error.message}`);
            }
        }

        // Convert Images to PDF using pdf-lib
        convertImagesBtn.addEventListener('click', async () => {
            if (selectedFiles.length === 0) {
                alert('Please upload at least one image to convert.');
                return;
            }

            progressMessage.textContent = 'Processing images...';
            const failedImages = [];

            try {
                // Create a new PDF document
                const pdfDoc = await PDFLib.PDFDocument.create();

                // Process each image
                for (let index = 0; index < selectedFiles.length; index++) {
                    const file = selectedFiles[index];
                    progressMessage.textContent = `Processing image ${index + 1} of ${selectedFiles.length}: ${file.name}`;

                    try {
                        // Load and normalize image to JPEG
                        const { base64, width, height } = await loadAndNormalizeImage(file);

                        // Embed the JPEG image in the PDF
                        const pdfImage = await pdfDoc.embedJpg(base64);

                        // Add a new page with A4 dimensions (595x842 points)
                        const page = pdfDoc.addPage([595, 842]);

                        // Calculate image dimensions to fit within A4 page with margins
                        const margin = 28; // 10mm margin at 72 DPI (~28 points)
                        const maxWidth = 595 - 2 * margin;
                        const maxHeight = 842 - 2 * margin;
                        let imgWidth = width;
                        let imgHeight = height;

                        // Scale image to fit while maintaining aspect ratio
                        if (imgWidth > maxWidth) {
                            imgHeight = (maxWidth / imgWidth) * imgHeight;
                            imgWidth = maxWidth;
                        }
                        if (imgHeight > maxHeight) {
                            imgWidth = (maxHeight / imgHeight) * imgWidth;
                            imgHeight = maxHeight;
                        }

                        // Center the image on the page
                        const x = (595 - imgWidth) / 2;
                        const y = (842 - imgHeight) / 2;

                        // Draw the image
                        page.drawImage(pdfImage, {
                            x,
                            y,
                            width: imgWidth,
                            height: imgHeight,
                        });
                    } catch (error) {
                        console.error(error);
                        failedImages.push(file.name);
                        progressMessage.textContent = `Failed to process ${file.name}. Continuing with remaining images...`;
                    }
                }

                if (pdfDoc.getPageCount() === 0) {
                    throw new Error('No images could be processed for conversion.');
                }

                progressMessage.textContent = 'Generating PDF...';

                // Serialize the PDF document
                const pdfBytes = await pdfDoc.save();
                const pdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
                const pdfUrl = URL.createObjectURL(pdfBlob);

                // Trigger download
                const link = document.createElement('a');
                link.href = pdfUrl;
                link.download = 'converted-images.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(pdfUrl);

                progressMessage.textContent = `Conversion complete! PDF downloaded with ${pdfDoc.getPageCount()} page(s).`;
                if (failedImages.length > 0) {
                    progressMessage.textContent += ` Warning: ${failedImages.length} image(s) failed to process: ${failedImages.join(', ')}.`;
                }

                // Reset after successful conversion
                selectedFiles = [];
                fileInput.value = '';
                updateFileList();
            } catch (error) {
                console.error('Image-to-PDF error:', error);
                alert(`Failed to convert images to PDF: ${error.message}${failedImages.length > 0 ? ` Skipped images: ${failedImages.join(', ')}.` : ''}`);
                progressMessage.textContent = '';
            }
        });

        // Reset Files
        resetFilesBtn.addEventListener('click', () => {
            selectedFiles = [];
            fileInput.value = '';
            fileList.innerHTML = '';
            dragDropArea.querySelector('p').textContent = 'Drag & Drop your images here (or tap to select)';
            progressMessage.textContent = 'Files have been reset. You can now choose new files.';
        });

        // Tools Popup Toggle
        const toolsButton = document.getElementById('tools-button');
        const toolsPopup = document.getElementById('tools-popup');
        const infoPopup = document.getElementById('info-popup');

        function toggleToolsPopup(event) {
            event.stopPropagation();
            console.log('Toggling tools popup');
            toolsPopup.classList.toggle('open');
            infoPopup.classList.remove('open');
            if (toolsPopup.classList.contains('open')) {
                console.log('Tools popup opened');
                toolsPopup.focus();
            } else {
                console.log('Tools popup closed');
            }
        }

        toolsButton.addEventListener('click', toggleToolsPopup);
        exploreToolsBtn.addEventListener('click', toggleToolsPopup);

        // Info Popup Toggle
        const infoButton = document.getElementById('info-button');

        infoButton.addEventListener('click', (event) => {
            event.stopPropagation();
            console.log('Info button clicked, toggling info popup');
            infoPopup.classList.toggle('open');
            toolsPopup.classList.remove('open');
            if (infoPopup.classList.contains('open')) {
                console.log('Info popup opened');
                infoPopup.focus();
            } else {
                console.log('Info popup closed');
            }
        });

        // Close Popups with Esc Key or Click Outside
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                if (toolsPopup.classList.contains('open')) {
                    console.log('Escape key pressed, closing tools popup');
                    toolsPopup.classList.remove('open');
                }
                if (infoPopup.classList.contains('open')) {
                    console.log('Escape key pressed, closing info popup');
                    infoPopup.classList.remove('open');
                }
            }
        });

        document.addEventListener('click', (event) => {
            if (!toolsPopup.contains(event.target) && !toolsButton.contains(event.target) && !exploreToolsBtn.contains(event.target) && toolsPopup.classList.contains('open')) {
                console.log('Clicked outside, closing tools popup');
                toolsPopup.classList.remove('open');
            }
            if (!infoPopup.contains(event.target) && !infoButton.contains(event.target) && infoPopup.classList.contains('open')) {
                console.log('Clicked outside, closing info popup');
                infoPopup.classList.remove('open');
            }
        });

        // Info Content Navigation
        const infoLinks = document.querySelectorAll('.info-link');
        const infoContent = document.getElementById('info-content');
        const sections = infoContent.querySelectorAll('div');

        infoLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const sectionId = link.getAttribute('href').substring(1);
                console.log(`Navigating to info section: ${sectionId}`);
                sections.forEach(section => {
                    section.style.display = section.id === sectionId ? 'block' : 'none';
                });
                infoPopup.scrollTop = 0;
            });
        });

        // Initialize Info Content
        sections.forEach((section, index) => {
            section.style.display = index === 0 ? 'block' : 'none';
        });

        // Tooltip Accessibility and Debugging
        [toolsButton, infoButton, exploreToolsBtn].forEach(button => {
            button.addEventListener('focus', () => {
                const tooltip = button.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.style.opacity = '1';
                    console.log(`Focus on ${button.id}: Tooltip visible`);
                }
            });
            button.addEventListener('blur', () => {
                const tooltip = button.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.style.opacity = '0';
                    console.log(`Blur on ${button.id}: Tooltip hidden`);
                }
            });
            button.addEventListener('mouseover', () => {
                const tooltip = button.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.style.opacity = '1';
                    console.log(`Hover on ${button.id}: Tooltip visible`);
                }
            });
            button.addEventListener('mouseout', () => {
                const tooltip = button.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.style.opacity = '0';
                    console.log(`Mouseout on ${button.id}: Tooltip hidden`);
                }
            });
        });
    </script>
</body>
</html>